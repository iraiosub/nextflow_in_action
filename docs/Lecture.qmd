---
title: "<span style='font-size: 0.8em; color: #3ac486;'>Nextflow in Action: Design and Implement Your Own Bioinformatics Workflows</span>"
author:
  - name: "Ira Iosub, PhD"
    affiliation: "Francis Crick Institute/KCL"
  - name: "Charlotte Capitanchik, PhD"
    affiliation: "Francis Crick Institute/KCL"
date: "March 31, 2025"
format: 
  revealjs:
    theme: dark
    code-fold: true
    highlight-style: github
    include-in-header:
      text: |
        <style>
        .reveal {
          font-family: "Palatino Linotype", "Book Antiqua", Palatino, serif;
        }
        .reveal h1, 
        .reveal h2, 
        .reveal h3, 
        .reveal h4, 
        .reveal h5, 
        .reveal h6 {
          font-family: "Palatino Linotype", "Book Antiqua", Palatino, serif;
        }
        .figure-caption, 
        figcaption, 
        .caption, 
        .figure p {
          font-size: 0.5em !important;
        }
        .reveal .title {
          margin-bottom: 1em;
        }
        </style>
editor: visual
output: 
    revealjs::revealjs_presentation:
        css: styles.css
---

A pipeline or workflow connects multiple programs together to analyse data.

::: {.figure .center}
![Wratten,Wilm & Goeke (2021), *Nature Methods*](Lecture_files/imgs/fig1_goeke_workflow_Review.png){width="75%"}
:::

------------------------------------------------------------------------
## Nextflow or Snakemake?
::: {.figure .center}
![ Djaffardjy et al., (2023), *Computational and Structural Biotechnology Journal*](Lecture_files/imgs/monthly_snakemake_nextflow_repos.jpg){width="75%"}
:::

## Why Nextflow?

::: columns
::: {.column width="40%"}
-   [nf-core]{style="color: #3ac486;"} community project:
    -   127 pipelines
    -   1443 modules
    -   Slack workspace with 11,642 members
-   GUIs such as Seqera platform, flow.bio
:::

::: {.column width="60%"}
![Organisations using nf-core as of March 2025](Lecture_files/imgs/nfcore_map.png){width="100%"}
:::
:::

## When to write a Nextflow pipeline?

![](Lecture_files/imgs/whenToNextflow.png){fig-align="center"}

## Let's write a toy pipeline together

![](Lecture_files/imgs/PIPELINE%20SUMMARY.png){fig-align="center"}

## Set up

You will need:

-   Nextflow

-   A container engine (Docker/Singularity/Apptainer)

-   nf-core (recommend installing with conda/mamba)

-   nf-test (recommend installing with conda/mamba)

## Choose your own adventure! ‚öîÔ∏è {.smaller}

All documents/code for this workshop is at `github.com/iraiosub/nextflow_in_action`.

The lecture is in `docs/Lecture.qmd.`

Choose what environment you will work with today:

1.  CREATE - instructions in `docs/CREATE_setup.md`
2.  Your laptop - we recommend downloading Dockerhub and using docker (ensure Dockerhub is running whenever you want to use it) and then using conda/mamba to install everything else: `mamba create -n nf -c conda-forge -c bioconda nextflow nf-core nf-test`
3.  (Last resort) Gitpod Codespace

## Getting the code {.smaller}

-   You will need to fork our Github repo `github.com/iraiosub/nextflow_in_action`
-   Uncheck the box that only forks the main branch.
-   If you are working on CREATE or locally, clone the repo.
-   Checkout branch `1` to get started

![Borrowed from https://biostats-r.github.io/biostats/github/3_Fork_Tutorial.html](Lecture_files/imgs/github_forking.png){width="70%"}

## Task 1

::: {.center}
üéØ Add a FASTQC step using nf-core tools

üí° Hint: To run the pipeline `nextflow run main.nf 
:::


## Task 2
::: {.center}
üéØ Write your own module to calculate sequence length and add it to the pipeline

üí° Hint: Look in the bin folder
:::

## Task 3
::: {.center}
üéØ Write a module to reverse complement the sequences

üéØ Add a parameter to make the reverse complement step optional
:::

## Task 4
::: {.center}
üéØ Write a module to calculate the mean GC content of the sequences

üéØ Use the same module twice in your pipeline. First, to calculate the mean GC content of each individual sequence and then secondly, to calculate the mean GC content of sequences belonging to each organism/species.

üí° Hint: You will need to manipulate the channels being passed to your module
:::

## Task 5
::: {.center}
üéØ Add a MultiQC step to finish your pipeline. The MultiQC report should contain a summary of all the FastQC reports for each sequence.

üí° Hint: MultiQC is an nf-core module. This will require some channel manipulation!
:::

## Task 6
::: {.center}
üéØ Use `ext.args` to generalise your GC content module so that you can also calculate AT content. Use `conf/modules.config` to set the `ext.args` for each time you import the module. 

üí° Hint: Look at the nf-core FastQC module to see how `ext.args` is used
üí° Hint: Remember to import `modules.config` in `nextflow.config`
:::
## Task 7
::: {.center}
üéØ Let's add tests to our pipeline with nf-test

üí° Hint: We will follow Seqera's nf-test training together: `https://training.nextflow.io/2.1.4/side_quests/nf-test/#10-initialize-nf-test`

:::
## Common headaches

-   Config hierarchies! You can convince yourself of this by messing around with where you set your `params.reverse_complement`...
![](Lecture_files/imgs/param hierarchy.png){fig-align="center"}

## Common headaches

-   Q: Why does only one sample run through the pipeline instead of all of them? A: Queue channels (e.g sample reads) vs. value channels (eg. genome reference). 
- If you print (with `println`) a channel variable and it‚Äôs a value channel, regardless of its content it will always show `DataflowVariable(value=null)`. A queue channel on the other hand will print `DataflowBroadcast around DataflowStream[?]`.

## Important resources

-  Nextflow and nf-core docs
-  nf-core Slack workspace
-  Forum for Nextflow questions: `https://community.seqera.io/`
-  Seqera AI
- VSCode Nextflow plugin
- nf-core/bytesize on YouTube
- Annual Nextflow Summit and hackathon in Barcelona, Boston and hybrid

